{% extends "watcher/base.html" %}
{% load static %}
{% load i18n %}
{% load humanize %}


{% block head %}
    <script src="{% static 'watcher/index.js' %}"></script>
{% endblock head %}

{% block main %}
    <div class="ui stackable grid container" style="padding-top: 5em;">
        <div class="four wide column">
            <div class="ui vertical fluid menu">
                <a class="item active" data-tab="tab-1">{% translate "Issues" %}</a>
                <a class="item" data-tab="tab-2">{% translate "Performance" %}</a>
                <a class="item" data-tab="tab-3">{% translate "Stats" %}</a>
            </div>
        </div>
        <div class="twelve wide stretched column">
            <div class="ui tab" data-tab="tab-1">
                <div class="ui segment">
                    <h1 class="ui dividing header">{% translate "Issues" %}</h1>
                    <div class="ui accordion">
                        <div class="active title">
                            <i class="dropdown icon"></i>
                            {% translate "Unresolved" %}
                        </div>
                        <div class="active content">
                            <div style="overflow-y: auto;">
                                <table class="ui celled unstackable striped table" id="unresolved-issues">
                                    <thead>
                                        <tr><th>ID</th>
                                        <th>Name</th>
                                        <th>Description</th>
                                        <th>Events</th>
                                        <th>Users</th>
                                        <th>First event</th>
                                        <th>Last event</th>
                                    </tr></thead>
                                    <tbody>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="title">
                            <i class="dropdown icon"></i>
                            {% translate "Resolved" %}
                        </div>
                        <div class="content">
                            <div style="overflow-y: auto;">
                                <table class="ui celled unstackable table" id="resolved-issues">
                                    <thead>
                                        <tr><th>ID</th>
                                        <th>Name</th>
                                        <th>Description</th>
                                        <th>Events</th>
                                        <th>Users</th>
                                    </tr></thead>
                                    <tbody>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="ui tab" data-tab="tab-2">
                <div class="ui segment">
                    <h1 class="ui dividing header">{% translate "Performance" %}</h1>
                    <h3 class="ui header">{{ requests.count }} requests</h3>
                    <div style="overflow-y: auto;">
                        <table class="ui celled unstackable table">
                            <thead>
                                <tr><th>App</th>
                                <th>Duration</th>
                            </tr></thead>
                            <tbody>
                                {% for result in requests_by_app %}
                                <tr>
                                    <td data-label="App">{{ result.app_name }}</td>
                                    <td data-label="Duration">{{ result.avg }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="ui tab" data-tab="tab-3">
                <div class="ui segment">
                    <h1 class="ui dividing header">{% translate "Stats" %}</h1>
                </div>
            </div>
        </div>
    </div>
    <script>
        $('.menu .item').tab()
        $('.ui.accordion').accordion()
        $(document).ready(function() {
            getIssues()
        })
    </script>
{% endblock %}