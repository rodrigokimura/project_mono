{% extends "base.html" %}
{% load static %}
{% load i18n %}

{% block body %}

<div class="pusher">
  <div class="ui fluid container">
    
    {% include 'project_manager/_breadcrumb.html' with breadcrumb=breadcrumb only %}
    <div class="row">
      <div class="ui segment">
        <div id="board" class="ui cards" style="overflow: scroll; display: flex; flex-flow: row nowrap;"></div>
      </div>
    </div>
    
    {% with object as b %}
    {% for bucket in b.bucket_set.all %}
    {% empty %}
    {% endfor %}
    {% endwith %}
  </div>
</div>
  
<script>
  $('*.ui.dropdown').dropdown();
  const PROJECT_ID = "{{ object.project.id }}";
  const BOARD_ID = "{{ object.id }}";

  const adjustBoardHeight = () => {

  } 

  let renderBuckets = (containerSelector, buckets) => {
    $(containerSelector).empty();
    buckets.forEach(e => {
      $(containerSelector).append(
        `
        <div class="card" style="width: 200px; flex: 0 0 auto;">
          <div class="content">
            ${e.name}
          </div>
        </div>
        `
      )
    });
    $(containerSelector).append(
      `
      <div class="ui button">Add</div>
      `
    );

  };

  const getBuckets = () => {
    $.get(`/pm/api/projects/${PROJECT_ID}/boards/${BOARD_ID}/buckets/`)
      .done(r => {
        renderBuckets(containerSelector='#board', r);
      })
      .fail(e => { console.error(e) })
      .always()
  };

  getBuckets();
</script>
{% endblock %}