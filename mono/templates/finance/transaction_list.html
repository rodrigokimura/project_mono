{% extends "finance/base.html" %}

{% block head %}
<style>
  .expense {color: #db2828}
  .income {color: #b5cc18}
  .muted {color: #656667}
  a.muted {color: #656667}
</style>
{% endblock head %}

{% block body %}

<div class="ui vertical stripe segment">
  <div class="ui grid container">
    
    <div class="row">
      <div class="column">
        {% if messages %}
        {% for message in messages %}
        <div class="ui {{ message.tags }} message">
          <i class="close icon"></i>
          {{ message }}
        </div>
        {% endfor %}
        {% endif %}
        <form class="ui form" method="GET" id="filter">
          <div class="field">
            <label>Category</label>
            <select name="category" id="category" class="ui fluid dropdown">
              {% if not request.GET.category %}
              <option value="">Select a category</option>
              {% endif %}
              {% for c in categories %}
              {% if c.id|stringformat:"i"  == request.GET.category %}
              <option selected value="{{ c.id }}">
                <i class="{{ c.icon }} icon"></i>{{ c.name }}
              </option>
              {% else %}
              <option value="{{ c.id }}">
                <i class="{{ c.icon }} icon"></i>{{ c.name }}
              </option>
              {% endif %}
              {% endfor %}
            </select>
          </div>
          <div class="ui fluid buttons">
            <button class="ui button primary" type="submit" form="filter">Filter</button>
            <a class="ui button" href="{% url 'finance:transactions' %}">Clear</a>
          </div>
        </form>
      </div>
    </div>
    
    <div class="ui horizontal divider">
      <i class="table icon"></i> Transactions
    </div>

    {% if object_list %}
    {% for date in dates %}
    <div class="row">
      <table class="ui unstackable single line fixed table">
        <thead>
        <tr>
          <th colspan=3>
            {{ date.date|date:"d/m" }}
          </th>
          <th>
            <p class="income">
              {{ date.total_income }}
            </p>
          </th>
          <th>
            <p class="expense">
              {{ date.total_expense }}
            </p>
          </th>
        </tr>
        </thead>
        <tbody>
          {% for transaction in object_list %}
          <tr class="muted">
          {% if transaction.date == date.date %}
            <td colspan=2>
              <a class="muted" href="{% url 'finance:transaction_update' pk=transaction.pk %}">
              <i class="{{ transaction.category.icon }} icon"></i>
                {{ transaction.category }}
              </a>
            </td>
            <td colspan=2>
              {{ transaction.account }}
            </td>
            <td 
              {% if transaction.type == 'INC' %}
              class="income"
              {% elif transaction.type == 'EXP' %}
              class="expense"
              {% endif %}
              >
              {{ transaction.ammount }}
            </td>
          {% endif %}
          </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
    {% endfor %}
    {% endif %}
    
    <div class="row">
        <a class="ui fluid button primary" href="{% url "finance:transaction_create" %}">Add transaction</a>
      </div>
    </div>
  </div>
</div>


<script>
  $('.ui.dropdown').dropdown();
  $('.message .close').click(function() {
    $(this)
    .closest('.message')
    .transition('fade');
  });
</script>

{% endblock %}