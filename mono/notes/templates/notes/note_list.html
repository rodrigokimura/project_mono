{% extends "notes/base.html" %}
{% load i18n %}

{% block head %}
  <style>
    .main.grid {
        padding-top: 0 !important;
        padding-left: 21em !important;
        padding-right: 1em !important;
    }
    @media screen and (max-width: 767px) {
        .computer.only {
            display: none !important;
            width: 0 !important;
        }
        .main.grid {
            padding-left: 1em !important;
            padding-right: 1em !important;
        }
    }
    .hidden {
        display: none;
    }
    @media only screen and (min-width: 768px) {
        a.toc {
            display: none !important;
        }
    }
    a.content {
        color: inherit;
        text-decoration: underline 0.1em rgba(0, 0, 0, 0);
        transition: text-decoration-color 300ms;
    }
    a.content:hover {
        text-decoration-color: rgba(255, 255, 255, 1);
    }
  </style>
{% endblock head %}

{% block menu %}
  <a class="toc computer only item"><i class="sidebar icon"></i></a>
  <div class="ui right flowing popup" style="width: 320px; max-height: 300px; overflow-y: auto; margin-right: 1em;">
  </div>
{% endblock menu %}

{% block sidebar %}
  <div class="ui sidebar inverted menu" style="padding: 1em;">
    <div class="ui inverted big list" data-notes-list="true" style="width: 100%;"></div>
  </div>
{% endblock sidebar %}
 

{% block main %}
    <div class="ui vertical left fixed computer only inverted main menu" style="padding-top: 3em; width: 20em; display: flex; flex-flow: column nowrap;">
        <div class="header item">
            <div class="ui inverted header">
                <em data-emoji=":notepad_spiral:" class="small"></em>
                <span style="padding-left: .5em;">Notes</span>
                <button class="circular ui icon right floated basic inverted button" onclick="showConfigModal()">
                    <i class="cog icon"></i>
                </button>
            </div>
        </div>
        <div style="overflow-y: auto;">
            <div class="ui big list" data-notes-list="true" style="width: 100%; padding: 1em;"></div>
        </div>
    </div>
    <div class="ui stackable compact main grid">
        <div class="row">
            <div class="twelve wide column">
                <div class="ui note hidden teal segment" style="height: calc(100vh - 5em); overflow-y: auto;"></div>
            </div>
            <div class="four wide computer only column">
                <a style="margin-bottom: 1em;" class="ui fluid green icon labeled create button" href="{% url 'notes:note_create' %}" data-tooltip="{% translate 'Create' %}" data-inverted=""><i class="add icon"></i>{% translate 'Create' %}</a>
                <a style="margin-bottom: 1em;" class="ui fluid yellow icon labeled edit disabled button" data-tooltip="{% translate 'Edit' %}" data-inverted=""><i class="edit icon"></i>{% translate 'Edit' %}</a>
                <a style="margin-bottom: 1em;" class="ui fluid red icon labeled delete disabled button" data-tooltip="{% translate 'Delete' %}" data-inverted=""><i class="delete icon"></i>{% translate 'Delete' %}</a>
            </div>
            <div class="four wide mobile only column">
                <a style="margin-bottom: 1em;" class="ui green icon create button" href="{% url 'notes:note_create' %}" data-tooltip="{% translate 'Create' %}" data-inverted=""><i class="add icon"></i></a>
                <div class="ui right floated buttons">
                    <a style="margin-bottom: 1em;" class="ui icon yellow edit disabled button" data-tooltip="{% translate 'Edit' %}" data-inverted=""><i class="edit icon"></i></a>
                    <a style="margin-bottom: 1em;" class="ui icon red delete disabled button" data-tooltip="{% translate 'Delete' %}" data-inverted=""><i class="delete icon"></i></a>
                </div>
            </div>
        </div>
    </div>
    <script>
        $('*[data-notes-list=true]').html(
            `
            {% for f in subfiles %}
                {{ f }}
            {% endfor %}
            `
        );

        const getNote = id => {
            var noteSegment = $('.ui.note.segment');
            noteSegment.removeClass('hidden').addClass('loading');
            $.get(
                url=`/nt/api/notes/${id}/`
            )
            .done(r => {
                $(".note.segment").html(r.html);
                $('.ui.edit.button')
                    .removeClass('disabled')
                    .attr('href', r.url);
                $('.ui.delete.button')
                    .removeClass('disabled')
                    .attr('href', r.delete_url);
            })
            .fail(() => {
                noteSegment.addClass('hidden');
            })
            .always(() => {
                noteSegment.removeClass('loading');
            })
        }
        
        {% if 'note' in request.session %}
            getNote({{ request.session.note }});
        {% else %}
            {% if request.user.note_set.all %}
                getNote({{ request.user.note_set.first.id }});
            {% endif %}
        {% endif %}
        
        $('.file.item').click(function(e) {
            getNote($(e.target).closest('.file.item').attr('data-id'));
        });
        $('.folder').click(function() {
            $(this).parent().siblings('.list').toggle({ duration: 200, easing: 'swing' });
            $(this).parent().children('.icon').toggleClass('open');
        })
        $('.ui.sidebar')
            .sidebar('setting', 'transition', 'slide along')
            .sidebar('setting', 'mobileTransition', 'slide along')
            .sidebar('attach events', '.toc.item');

        MutationObserver = window.MutationObserver || window.WebKitMutationObserver;
        var observer = new MutationObserver(function(mutations, observer) {
            $('table').addClass('ui table');
        });
        observer.observe(document, {
            subtree: true,
            attributes: true
        });

    </script>

    {{ form.media }}
{% endblock main %}